Menu="UNRAID-OS"
Title="New Config"
---
<?PHP
/* Copyright 2005-2016, Lime Technology
 * Copyright 2015-2016, Bergware International.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
?>
<?
$super = file_exists('/boot/config/super.dat');
$disabled = $var['fsState']=="Started" || !$super ? 'disabled' : '';
?>
<style>
span.indent{display:inline-block;width:200px;}
</style>

<?if (file_exists('/var/tmp/disks.ini')):?>
<script>
function assign(id,disk) {
  var pair = {changeDevice:'Apply'};
  pair['slotId.'+id] = disk;
  $.post('/update.htm',pair);
}
<?
$disks = parse_ini_file('/var/tmp/disks.ini',true);
foreach ($disks as $disk) echo "assign('{$disk['idx']}','{$disk['id']}');";
unlink('/var/tmp/disks.ini');
?>
</script>
<?endif;?>
This is a utility to reset the array disk configuration so that all disks appear as "New" disks, as
if it were a fresh new server.

This is useful when you have added or removed multiple drives and wish to rebuild parity based on
the new configuration.

Use the *'Preset current configuration'* selection to populate the desired slots **after** the array has been reset. By default all slots are populated.

**DO NOT USE THIS UTILITY THINKING IT WILL REBUILD A FAILED DRIVE** - it will have the opposite
effect of making it ***impossible*** to rebuild an existing failed drive - you have been warned!
<hr>
<form name="newConfig" method="POST" action="/update.htm" target="progressFrame">
<span class="indent">Preset current configuration:</span>
<select name="preset" class="narrow" <?=$disabled?>>
<?=mk_option('.','Parity|Data|Cache','All')?>
<?=mk_option('.','Parity','Parity only')?>
<?=mk_option('.','Parity|Data','Parity + Data')?>
<?=mk_option('.','Parity|Cache','Parity + Cache')?>
<?=mk_option('.','','None')?>
</select>
<br>
<span class="indent"><input type="submit" name="cmdInit" value="Apply" onclick="$.post('/webGui/include/PrepareDisks.php',{preset:preset.value})" disabled><input type="button" value="Done" onclick="done()"></span>
<?if ($disabled):?>
<?if ($super):?>Array must be <strong><big>stopped</big></strong><?else:?>Array has been <strong><big>reset</big></strong> (please configure)<?endif;?>
<?else:?>
<input type="checkbox" onClick="cmdInit.disabled=!this.checked"><small>Yes I want to do this</small>
<?endif;?>
</form>

> *Preset current configuration*

> + **All** - parity, data and cache disks are populated with the current disk assignment **after** an array reset
> + **Parity only** - only parity disk(s) are populated, data and cache disks will be unassigned
> + **Parity + Data** - parity and data disks are populated, cache disks will be unassigned
> + **Parity + Cache** - parity and cache disks are populated, data disks will be unassigned
> + **None** - parity, data and cache disks will all be unassigned
